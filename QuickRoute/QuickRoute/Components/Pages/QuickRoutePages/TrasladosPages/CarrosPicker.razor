<div class="col-auto input-group align-items-center">
    <label class="col-form-label input-group-text">Carro</label>
    <InputSelect class="form-select" @bind-Value="CarroId">
        <option disabled value="0">Seleccione un carro</option>
        @foreach (var carro in Carros)
        {
            <option value="@carro.CarroId">@($"{carro.Marca} {carro.Modelo}")</option>
        }
    </InputSelect>
    <label class="col-form-label input-group-text">Monto</label>
    <InputNumber class="form-control" id="monto-input" @bind-Value="Monto" min="0" />
    <button type="button" class="btn btn-outline-success bi bi-plus" @onclick="HandleSelection"></button>
</div>

<label class="text-success" hidden="@string.IsNullOrEmpty(Saved)">@Saved</label>
<label class="text-danger" hidden="@string.IsNullOrEmpty(Error)">@Error</label>

@code {
    [Parameter]
    public List<Carros> Carros { get; set; } = new List<Carros>();

    [Parameter]
    public int CarroId { get; set; } = 0;

    [Parameter]
    public double Monto { get; set; }

    [Parameter]
    public EventCallback<(Carros Carro, double Monto)> OnCarroSelected { get; set; }

    private string Error { get; set; } = string.Empty;
    private string Saved { get; set; } = string.Empty;

    private async Task HandleSelection()
    {
        ResetMessages();

        if (!IsValidSelection(out var carroSeleccionado))
        {
            return;
        }

        await OnCarroSelected.InvokeAsync((carroSeleccionado, Monto));
        Saved = "Carro y Monto seleccionados correctamente.";
    }

    private void ResetMessages()
    {
        Error = string.Empty;
        Saved = string.Empty;
    }

    private bool IsValidSelection(out Carros carroSeleccionado)
    {
        carroSeleccionado = null;
        if (CarroId <= 0)
        {
            Error = "Por favor, seleccione un carro.";
            return false;
        }
        carroSeleccionado = Carros.FirstOrDefault(c => c.CarroId == CarroId);
        if (carroSeleccionado == null)
        {
            Error = "Carro no encontrado.";
            return false;
        }
        return true;
    }
}